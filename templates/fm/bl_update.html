<!-- SPA íƒ­ìš© ê±´ë¬¼ìˆ˜ì • í˜ì´ì§€ -->
<link rel="stylesheet" href="/static/css/common.css">
<style>
    /* bl_update ìŠ¤íƒ€ì¼ - ë‹¤ë¥¸ í˜ì´ì§€ì™€ ì¼ê´€ì„± ë§ì¶¤ */
    #bl_update_outer {
        padding: 20px;
        padding-bottom: 0;
        overflow-y: auto;
        background-color: #f8f9fa;
        font-size: 12px;
    }

    #bl_update_outer .button-area {
        text-align: right;
        margin-bottom: 15px;
        padding: 15px;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #bl_update_outer .button-area button {
        margin-left: 5px;
        padding: 6px 12px;
        background: #fff;
        color: #333;
        border: 1px solid #ced4da;
        font-size: 12px;
        font-family: inherit;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.15s ease-in-out;
    }

    #bl_update_outer .button-area button:hover {
        background-color: #e9ecef;
        border-color: #adb5bd;
    }

    #bl_update_outer .button-area button.btn-primary {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }

    #bl_update_outer .button-area button.btn-primary:hover {
        background: #0056b3;
        border-color: #004085;
    }

    #bl_update_outer .selection-area {
        margin-bottom: 15px;
    }

    #bl_update_outer .selection-area .table {
        margin-bottom: 0;
        background-color: white;
        border-collapse: collapse;
        font-size: 12px;
    }

    #bl_update_outer .selection-area .table td {
        padding: 8px;
        border: 1px solid #dee2e6;
        vertical-align: middle;
    }

    #bl_update_outer .selection-area .table-header {
        background-color: #f8f9fa;
        font-weight: bold;
        text-align: center;
        width: 10%;
    }

    #bl_update_outer .tab-area {
        margin-bottom: 15px;
    }

    #bl_update_outer .tab-area .nav-tabs {
        border-bottom: 1px solid #dee2e6;
        background-color: white;
        display: flex;
        margin: 0;
        padding: 0;
        list-style: none;
    }

    #bl_update_outer .tab-area .nav-link {
        font-size: 13px;
        font-weight: 500;
        color: #666;
        padding: 10px 16px;
        cursor: pointer;
        border: none;
        border-bottom: 2px solid transparent;
        background-color: #f8f9fa;
        margin-right: 2px;
        border-radius: 4px 4px 0 0;
        text-decoration: none;
        display: block;
        transition: all 0.15s ease-in-out;
    }

    #bl_update_outer .tab-area .nav-link:hover {
        background-color: #e9ecef;
        border-color: transparent;
    }

    #bl_update_outer .tab-area .nav-link.active {
        color: #495057;
        background-color: white;
        border-color: #007bff;
        font-weight: bold;
    }

    #bl_update_outer .content-area {
        background-color: white;
        border-radius: 5px;
        border: 1px solid #dee2e6;
        min-height: 500px;
    }

    #bl_update_outer .tab-content {
        display: none;
        padding: 20px;
    }

    #bl_update_outer .tab-content.active {
        display: block;
    }

    #bl_update_outer .form-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 12px;
    }

    #bl_update_outer .form-table td {
        padding: 8px;
        border: 1px solid #dee2e6;
        vertical-align: middle;
    }

    #bl_update_outer .form-table .label {
        background-color: #f8f9fa;
        font-weight: bold;
        text-align: center;
        width: 12%;
        min-width: 80px;
    }

    #bl_update_outer .form-table input,
    #bl_update_outer .form-table select,
    #bl_update_outer .form-table textarea {
        border: 1px solid #ced4da;
        border-radius: 4px;
        padding: 4px 6px;
        font-size: 12px;
        width: 100%;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    #bl_update_outer .form-table input:focus,
    #bl_update_outer .form-table select:focus,
    #bl_update_outer .form-table textarea:focus {
        border-color: #007bff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    #bl_update_outer .form-table .text-right {
        text-align: right;
    }

    #bl_update_outer .form-table input[readonly] {
        background-color: #e9ecef;
    }

    #bl_update_outer .form-table label {
        margin-right: 8px;
        margin-bottom: 0;
        font-weight: normal;
        font-size: 12px;
    }

    #bl_update_outer .form-table input[type="radio"] {
        width: auto;
        margin-right: 4px;
    }

    /* ì´ë ¥/ì‚¬ì§„ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    #bl_update_outer .search-area {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    #bl_update_outer .search-area select,
    #bl_update_outer .search-area input {
        padding: 4px 8px;
        border: 1px solid #ced4da;
        font-size: 12px;
        border-radius: 4px;
    }

    #bl_update_outer .search-area select {
        width: 120px;
    }

    #bl_update_outer .search-area input[type="date"] {
        width: 120px;
    }

    #bl_update_outer .search-area input[type="text"] {
        width: 150px;
    }

    #bl_update_outer .search-area button {
        padding: 4px 12px;
        background: #fff;
        color: #333;
        border: 1px solid #ced4da;
        font-size: 12px;
        border-radius: 4px;
        cursor: pointer;
    }

    #bl_update_outer .search-area button:hover {
        background: #e9ecef;
    }

    #bl_update_outer .data-table {
        border: 1px solid #dee2e6;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 15px;
    }

    #bl_update_outer .data-table .table {
        margin-bottom: 0;
        border-collapse: collapse;
        width: 100%;
        font-size: 12px;
    }

    #bl_update_outer .data-table .table th {
        background-color: #f8f9fa;
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
        border: 1px solid #dee2e6;
        padding: 8px;
    }

    #bl_update_outer .data-table .table td {
        vertical-align: middle;
        border: 1px solid #dee2e6;
        padding: 8px;
        cursor: pointer;
    }

    #bl_update_outer .data-table .table tbody tr:hover {
        background-color: #f8f9fa;
    }

    #bl_update_outer .data-table .table tbody tr.table-active {
        background-color: #e3f2fd;
        border-left: 3px solid #2196f3;
    }

    #bl_update_outer .photo-viewer {
        position: fixed;
        right: 20px;
        top: 120px;
        width: 300px;
        height: 400px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 15px;
        display: flex;
        flex-direction: column;
        z-index: 1000;
    }

    #bl_update_outer .photo-title {
        font-weight: bold;
        margin-bottom: 10px;
        text-align: center;
        color: #495057;
        font-size: 13px;
    }

    #bl_update_outer .photo-display {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        overflow: hidden;
    }

    #bl_update_outer .photo-display img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    #bl_update_outer .photo-controls {
        text-align: center;
    }

    #bl_update_outer .photo-controls button {
        margin: 0 4px;
        padding: 4px 8px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
    }

    #bl_update_outer .photo-controls button:hover {
        background-color: #0056b3;
    }

    .main-photo-indicator {
        color: #dc3545;
        font-weight: bold;
        font-size: 11px;
    }

    /* ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ */
    .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        border: 1px solid #f5c6cb;
        font-size: 12px;
    }

    .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        border: 1px solid #c3e6cb;
        font-size: 12px;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 1200px) {
        #bl_update_outer .photo-viewer {
            position: relative;
            right: auto;
            top: auto;
            width: 100%;
            height: 300px;
            margin-top: 15px;
        }
    }

    @media (max-width: 768px) {
        #bl_update_outer {
            padding: 10px;
        }
        
        #bl_update_outer .search-area {
            flex-direction: column;
            align-items: stretch;
        }
        
        #bl_update_outer .search-area select,
        #bl_update_outer .search-area input {
            width: 100%;
            margin-bottom: 5px;
        }
    }
</style>

<div id="bl_update_outer">
    <!-- ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ -->
    <div class="button-area">
        <button type="button" id="btn_delete_photo" onclick="BlUpdateModule.deleteMainPhoto()">ë©”ì¸ì‚¬ì§„ì‚­ì œ</button>
        <button type="button" id="btn_print" onclick="BlUpdateModule.printBl()">ì¸ì‡„</button>
        <button type="button" id="btn_save" class="btn-primary" onclick="BlUpdateModule.saveBlData()">ì €ì¥</button>
        <button type="button" id="btn_excel" onclick="BlUpdateModule.exportExcel()">ì—‘ì…€ì €ì¥</button>
        <button type="button" id="btn_list" onclick="BlUpdateModule.goToBlList()">ëª©ë¡ë³´ê¸°</button>
    </div>

    <!-- ì‚¬ì—…ì¥/ê±´ë¬¼ ì„ íƒ ì˜ì—­ -->
    <div class="selection-area">
        <table class="table">
            <tr>
                <td class="table-header">ì‚¬ì—…ì¥</td>
                <td id="prop_info">ë¡œë”© ì¤‘...</td>
                <td class="table-header">ê±´ë¬¼</td>
                <td>
                    <select id="bl_select" onchange="BlUpdateModule.changeBlSelection()">
                        <option value="">--ê±´ë¬¼ì„ íƒ--</option>
                    </select>
                </td>
            </tr>
        </table>
    </div>

    <!-- íƒ­ ì˜ì—­ -->
    <div class="tab-area">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="#" data-tab="1" onclick="BlUpdateModule.showTab(1, this)">ê±´ë¬¼ê°œìš”</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" data-tab="2" onclick="BlUpdateModule.showTab(2, this)">ê¸°íƒ€ì •ë³´</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" data-tab="3" onclick="BlUpdateModule.showTab(3, this)">ê±´ë¬¼ì´ë ¥</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" data-tab="4" onclick="BlUpdateModule.showTab(4, this)">ì‚¬ì§„</a>
            </li>
        </ul>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
    <div class="content-area">
        <!-- íƒ­ 1: ê±´ë¬¼ê°œìš” -->
        <div id="tab1_content" class="tab-content active">
            <table class="form-table">
                <tr>
                    <td class="label">ê±´ë¬¼ëª…</td>
                    <td><input type="text" id="name"></td>
                    <td class="label">ì†Œìœ ì£¼</td>
                    <td><input type="text" id="landlord"></td>
                </tr>
                <tr>
                    <td class="label">ì„¤ê³„ì</td>
                    <td><input type="text" id="design"></td>
                    <td class="label">ì‹œê³µì‚¬</td>
                    <td><input type="text" id="builder"></td>
                </tr>
                <tr>
                    <td class="label">ì†Œì¬ì§€</td>
                    <td colspan="3"><input type="text" id="address1"></td>
                </tr>
                <tr>
                    <td class="label">ì—°ë©´ì (ã¡)</td>
                    <td>
                        <input type="text" id="area_total" class="text-right" onkeyup="BlUpdateModule.calculatePyeong()"> ã¡
                        <input type="text" id="area_total_pyeong" class="text-right" readonly> í‰
                    </td>
                    <td class="label">ì§€ëª©</td>
                    <td><input type="text" id="class_land"></td>
                </tr>
                <tr>
                    <td class="label">ì§€ì—­</td>
                    <td><input type="text" id="district"></td>
                    <td class="label">ì§€êµ¬</td>
                    <td><input type="text" id="section"></td>
                </tr>
                <tr>
                    <td class="label">ê±´ì¶•ë©´ì </td>
                    <td><input type="text" id="area_bl" class="text-right"> ã¡</td>
                    <td class="label">ëŒ€ì§€ë©´ì </td>
                    <td><input type="text" id="parcel" class="text-right"> ã¡</td>
                </tr>
                <tr>
                    <td class="label">ê±´íìœ¨</td>
                    <td><input type="text" id="bl_to_land_ratio" class="text-right"> %</td>
                    <td class="label">ì „ìš©ìœ¨</td>
                    <td><input type="text" id="exclusive_ratio" class="text-right" readonly> %</td>
                </tr>
                <tr>
                    <td class="label">ìš©ì ìœ¨</td>
                    <td><input type="text" id="fl_space_index" class="text-right"> %</td>
                    <td class="label">ì „ìš©ë©´ì </td>
                    <td><input type="text" id="area_usable" class="text-right"> ã¡</td>
                </tr>
                <tr>
                    <td class="label">ê±´ì¶•êµ¬ì¡°</td>
                    <td><input type="text" id="construction_type"></td>
                    <td class="label">ì§€ë¶•í˜•íƒœ</td>
                    <td><input type="text" id="roof_type"></td>
                </tr>
                <tr>
                    <td class="label">ì¸µìˆ˜<br>ì§€ìƒ/ì§€í•˜</td>
                    <td>
                        <input type="text" id="count_fl" class="text-right" style="width:45%; display:inline-block"> ì¸µ /
                        <input type="text" id="count_bf" class="text-right" style="width:45%; display:inline-block"> ì¸µ
                    </td>
                    <td class="label">ìµœê³ ë†’ì´<br>ì§€ìƒ/ì§€í•˜</td>
                    <td>
                        <input type="text" id="bl_height" class="text-right" style="width:45%; display:inline-block"> m /
                        <input type="text" id="bl_depth" class="text-right" style="width:45%; display:inline-block"> m
                    </td>
                </tr>
                <tr>
                    <td class="label">ì£¼ìš©ë„</td>
                    <td><input type="text" id="use1"></td>
                    <td class="label">ì¤€ê³µì¼</td>
                    <td><input type="date" id="date_bl"></td>
                </tr>
                <tr>
                    <td class="label">ì£¼ì°¨ì„¤ë¹„</td>
                    <td colspan="3"><input type="text" id="parking_type"></td>
                </tr>
                <tr>
                    <td class="label">ìŠ¹ê°•ì„¤ë¹„</td>
                    <td colspan="3"><input type="text" id="elev_type"></td>
                </tr>
                <tr>
                    <td class="label">ìˆ˜ì „ì„¤ë¹„</td>
                    <td colspan="3"><input type="text" id="elec_type"></td>
                </tr>
                <tr>
                    <td class="label">ë°œì „ì„¤ë¹„</td>
                    <td colspan="3"><input type="text" id="generator_type"></td>
                </tr>
                <tr>
                    <td class="label">ë‚œë°©ì„¤ë¹„</td>
                    <td colspan="3"><input type="text" id="heating_type"></td>
                </tr>
                <tr>
                    <td class="label">ëƒ‰ë°©ì„¤ë¹„</td>
                    <td colspan="3"><input type="text" id="cooling_type"></td>
                </tr>
                <tr>
                    <td class="label">ë‹´ë‹¹ì</td>
                    <td><input type="text" id="contact_name"></td>
                    <td class="label">ëŒ€í‘œë²ˆí˜¸</td>
                    <td><input type="text" id="contact_phone"></td>
                </tr>
                <tr>
                    <td class="label">FAX</td>
                    <td><input type="text" id="contact_fax"></td>
                    <td class="label">ìš°í¸ë²ˆí˜¸</td>
                    <td><input type="text" id="zip"></td>
                </tr>
            </table>
        </div>

        <!-- íƒ­ 2: ê¸°íƒ€ì •ë³´ -->
        <div id="tab2_content" class="tab-content">
            <table class="form-table">
                <tr>
                    <td class="label">ë“±ê¸°ì—¬ë¶€</td>
                    <td>
                        <label><input type="radio" name="regist" value="1"> ìœ </label>
                        <label><input type="radio" name="regist" value="0"> ë¬´</label>
                    </td>
                    <td class="label">ê±´ë¬¼ì·¨ë“ì¼</td>
                    <td><input type="date" id="date_buy"></td>
                </tr>
                <tr>
                    <td class="label">ëŒ€ì§€ì·¨ë“ì¼</td>
                    <td><input type="date" id="date_buy_land"></td>
                    <td class="label">ë§¤ê°ì¼ì</td>
                    <td><input type="date" id="date_sailed"></td>
                </tr>
                <tr>
                    <td class="label">ê´€ë¦¬ê°œì‹œì¼</td>
                    <td><input type="date" id="date_manage_start"></td>
                    <td class="label">ê³µì‹œì§€ê°€</td>
                    <td><input type="text" id="price_pa_land" class="text-right"> ì›</td>
                </tr>
                <tr>
                    <td class="label">ì§€ìƒì¸µë©´ì </td>
                    <td><input type="text" id="area_fl" class="text-right"> ã¡</td>
                    <td class="label">ì§€í•˜ì¸µë©´ì </td>
                    <td><input type="text" id="area_bf" class="text-right"> ã¡</td>
                </tr>
                <tr>
                    <td class="label">ì„ëŒ€ê°€ëŠ¥ë©´ì </td>
                    <td><input type="text" id="area_rentable" class="text-right"> ã¡</td>
                    <td class="label">ì¡°ê²½ë©´ì </td>
                    <td><input type="text" id="area_garden" class="text-right"> ã¡</td>
                </tr>
                <tr>
                    <td class="label">ì¥ë¶€ê°€</td>
                    <td><input type="text" id="price_book_value" class="text-right"> ì›</td>
                    <td class="label">ì„ëŒ€ê°€ í™˜ì‚°ìœ¨</td>
                    <td><input type="text" id="base_rate" class="text-right"> %</td>
                </tr>
                <tr>
                    <td class="label">4ì¸µ ì‚¬ìš©</td>
                    <td>
                        <label><input type="radio" name="use_fl_4" value="1"> ìœ </label>
                        <label><input type="radio" name="use_fl_4" value="0"> ë¬´</label>
                    </td>
                    <td class="label">13ì¸µì‚¬ìš©</td>
                    <td>
                        <label><input type="radio" name="use_fl_13" value="1"> ìœ </label>
                        <label><input type="radio" name="use_fl_13" value="0"> ë¬´</label>
                    </td>
                </tr>
                <tr>
                    <td class="label">ì „ë©´ë„ë¡œí­</td>
                    <td><input type="text" id="width_front_road" class="text-right"> m</td>
                    <td class="label">í›„ë©´ë„ë¡œí­</td>
                    <td><input type="text" id="width_back_road" class="text-right"> m</td>
                </tr>
                <tr>
                    <td class="label">ì¸¡ë©´ë„ë¡œí­</td>
                    <td><input type="text" id="width_side_road" class="text-right"> m</td>
                    <td class="label">ì˜¥ë‚´ì£¼ì°¨ëŒ€ìˆ˜</td>
                    <td><input type="text" id="parking_unit_inner" class="text-right"> ëŒ€</td>
                </tr>
                <tr>
                    <td class="label">ì˜¥íƒ‘ìœ ë¬´</td>
                    <td>
                        <label><input type="radio" name="ph" value="1"> ìœ </label>
                        <label><input type="radio" name="ph" value="0"> ë¬´</label>
                    </td>
                    <td class="label">ì˜¥ì™¸ì£¼ì°¨ëŒ€ìˆ˜</td>
                    <td><input type="text" id="parking_unit_outdoor" class="text-right"> ëŒ€</td>
                </tr>
                <tr>
                    <td class="label">E/LëŒ€ìˆ˜</td>
                    <td><input type="text" id="el_unit" class="text-right"> ëŒ€</td>
                    <td class="label">E/SëŒ€ìˆ˜</td>
                    <td><input type="text" id="es_unit" class="text-right"> ëŒ€</td>
                </tr>
                <tr>
                    <td class="label">ë¹„ê³ </td>
                    <td colspan="3"><textarea id="comments" rows="3"></textarea></td>
                </tr>
            </table>
        </div>

        <!-- íƒ­ 3: ê±´ë¬¼ì´ë ¥ -->
        <div id="tab3_content" class="tab-content">
            <div class="search-area">
                <select id="history_type" onchange="BlUpdateModule.loadHistoryData()">
                    <option value="2">ì´ë ¥ê´€ë¦¬</option>
                    <option value="3">íŒŒì¼ê´€ë¦¬</option>
                </select>
                <input type="date" id="history_date_start" onchange="BlUpdateModule.loadHistoryData()">
                ~
                <input type="date" id="history_date_end" onchange="BlUpdateModule.loadHistoryData()">
                <input type="text" id="history_search" placeholder="ë“±ë¡ì,ì œëª©,ë‚´ìš©" onkeypress="if(event.keyCode==13) BlUpdateModule.loadHistoryData()">
                <button type="button" id="btn_history_search" onclick="BlUpdateModule.loadHistoryData()">ì¡°íšŒ</button>
                <button type="button" id="btn_history_register" onclick="BlUpdateModule.registerHistory()">ë“±ë¡</button>
            </div>
            
            <div class="data-table">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="55%">ì œëª©</th>
                            <th width="15%">ë“±ë¡ì</th>
                            <th width="15%">ë“±ë¡ì¼ì</th>
                            <th width="15%">íŒŒì¼</th>
                        </tr>
                    </thead>
                    <tbody id="history_table_body">
                        <tr><td colspan="4" class="text-center">ì´ë ¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- íƒ­ 4: ì‚¬ì§„ -->
        <div id="tab4_content" class="tab-content">
            <div class="search-area">
                <input type="date" id="photo_date_start" onchange="BlUpdateModule.loadPhotoData()">
                ~
                <input type="date" id="photo_date_end" onchange="BlUpdateModule.loadPhotoData()">
                <input type="text" id="photo_search" placeholder="ë“±ë¡ì,ì œëª©,ë‚´ìš©" onkeypress="if(event.keyCode==13) BlUpdateModule.loadPhotoData()">
                <button type="button" id="btn_photo_search" onclick="BlUpdateModule.loadPhotoData()">ì¡°íšŒ</button>
                <button type="button" id="btn_photo_register" onclick="BlUpdateModule.registerPhoto()">ë“±ë¡</button>
            </div>
            
            <div class="data-table">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="55%">ì œëª©</th>
                            <th width="15%">ë“±ë¡ì</th>
                            <th width="15%">ë“±ë¡ì¼ì</th>
                            <th width="15%">íŒŒì¼</th>
                        </tr>
                    </thead>
                    <tbody id="photo_table_body">
                        <tr><td colspan="4" class="text-center">ì‚¬ì§„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="photo-viewer">
                <div class="photo-title" id="photo_title">ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</div>
                <div class="photo-display">
                    <img id="photo_image" src="/static/images/common/no_image.png" alt="ì‚¬ì§„">
                </div>
                <div class="photo-controls">
                    <button type="button" id="btn_prev_photo" onclick="BlUpdateModule.prevPhoto()">â—€â—€â—€</button>
                    <button type="button" id="btn_next_photo" onclick="BlUpdateModule.nextPhoto()">â–¶â–¶â–¶</button>
                </div>
            </div>
        </div>
    </div>

    <!-- íˆë“  í•„ë“œë“¤ -->
    <input type="hidden" id="current_bl_id" value="">
    <input type="hidden" id="current_prop_id" value="">
    <input type="hidden" id="current_tab" value="1">
</div>

<script>
// ğŸ›¡ï¸ ì™„ì „í•œ ìŠ¤ì½”í”„ ë¶„ë¦¬ - ë³€ìˆ˜ ì¶©ëŒ ë°©ì§€
(function() {
    'use strict';
    
    console.log('ğŸ¢ bl_update.html ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘!');
    
    // ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± - ì¤‘ë³µ ë°©ì§€
    if (typeof window.BlUpdateModule !== 'undefined') {
        console.log('ğŸ¢ ê¸°ì¡´ ëª¨ë“ˆ ì¬ì‚¬ìš©');
        return; // ì´ë¯¸ ë¡œë“œë¨
    }
    
    // ëª¨ë“ˆ ìƒì„±
    window.BlUpdateModule = {
        // ë°ì´í„° ì €ì¥ì†Œ
        data: {
            currentBlId: null,
            currentPropId: null,
            currentTab: 1,
            blList: [],
            historyData: [],
            photoData: [],
            selectedPhotoIndex: 0,
            isInitialized: false,
            hasPermission: false
        },
        
        // ì´ˆê¸°í™”
        init: function() {
            console.log('ğŸ¢ ê±´ë¬¼ìˆ˜ì • í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');
            
            if (this.data.isInitialized) {
                console.log('ğŸ¢ ì´ë¯¸ ì´ˆê¸°í™”ë¨');
                return;
            }
            
            const em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
            const prop_id = window.currentPropId;
            const bl_id = window.selected_bl_id;
            
            console.log('ğŸ¢ ë°›ì€ ë°ì´í„°:', { em_id, prop_id, bl_id });
            
            if (!em_id) {
                console.error('ğŸ¢ em_idê°€ ì—†ìŠµë‹ˆë‹¤.');
                this.showError('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!prop_id) {
                console.error('ğŸ¢ prop_idê°€ ì—†ìŠµë‹ˆë‹¤.');
                this.showError('ì‚¬ì—…ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            this.data.currentPropId = prop_id;
            this.data.isInitialized = true;
            
            // ì‚¬ì—…ì†Œ ì •ë³´ í‘œì‹œ
            this.displayPropInfo();
            
            // ê±´ë¬¼ ëª©ë¡ ë¡œë“œ
            this.loadBlSelectOptions();
            
            // bl_idê°€ ì§€ì •ëœ ê²½ìš° í•´ë‹¹ ê±´ë¬¼ ë¡œë“œ
            if (bl_id) {
                setTimeout(() => {
                    this.loadBlData(bl_id);
                }, 500);
            }
        },
        
        // ì‚¬ì—…ì†Œ ì •ë³´ í‘œì‹œ
        displayPropInfo: function() {
            const prop_id = this.data.currentPropId;
            if (prop_id && window.propList) {
                const prop = window.propList.find(p => p.prop_id === prop_id);
                if (prop) {
                    document.getElementById('prop_info').textContent = `${prop.prop_name} (${prop.prop_id})`;
                }
            }
        },
        
        // ê±´ë¬¼ ì„ íƒ ì˜µì…˜ ë¡œë“œ
        loadBlSelectOptions: function() {
            const em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
            const prop_id = this.data.currentPropId;
            
            if (!em_id || !prop_id) return;
            
            fetch('/common/get_bl_list', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ em_id: em_id, prop_id: prop_id })
            })
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('bl_select');
                select.innerHTML = '<option value="">--ê±´ë¬¼ì„ íƒ--</option>';
                
                if (data.success && data.data) {
                    this.data.blList = data.data;
                    data.data.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.bl_id;
                        option.textContent = item.bl_name;
                        select.appendChild(option);
                    });
                    console.log('ğŸ¢ ê±´ë¬¼ ì„ íƒ ì˜µì…˜ ë¡œë“œ ì™„ë£Œ:', data.data.length, 'ê°œ');
                    
                    // selected_bl_idê°€ ìˆìœ¼ë©´ ì„ íƒ
                    if (window.selected_bl_id) {
                        select.value = window.selected_bl_id;
                    }
                }
            })
            .catch(error => {
                console.error('ğŸ¢ ê±´ë¬¼ ì„ íƒ ì˜µì…˜ ë¡œë“œ ì˜¤ë¥˜:', error);
            });
        },
        
        // ê±´ë¬¼ ì„ íƒ ë³€ê²½
        changeBlSelection: function() {
            const select = document.getElementById('bl_select');
            const bl_id = select.value;
            
            if (bl_id) {
                this.loadBlData(bl_id);
            } else {
                this.clearForm();
            }
        },
        
        // ê±´ë¬¼ ë°ì´í„° ë¡œë“œ
        loadBlData: function(bl_id) {
            console.log('ğŸ¢ ê±´ë¬¼ ë°ì´í„° ë¡œë“œ ì‹œì‘:', bl_id);
            
            if (!bl_id) return;
            
            this.data.currentBlId = bl_id;
            document.getElementById('current_bl_id').value = bl_id;
            
            const em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
            
            this.showLoading('ê±´ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            
            fetch('/fm/bl_update/get_bl_data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ bl_id: bl_id, em_id: em_id })
            })
            .then(response => response.json())
            .then(data => {
                console.log('ğŸ¢ ê±´ë¬¼ ë°ì´í„° ì‘ë‹µ:', data);
                
                if (data.success) {
                    this.data.hasPermission = data.has_permission;
                    this.populateForm(data.data);
                    this.hideLoading();
                    
                    // í˜„ì¬ íƒ­ì— ë”°ë¼ ì¶”ê°€ ë°ì´í„° ë¡œë“œ
                    if (this.data.currentTab === 3) {
                        this.loadHistoryData();
                    } else if (this.data.currentTab === 4) {
                        this.loadPhotoData();
                    }
                    
                    // ê¶Œí•œ ì²´í¬
                    this.updatePermissionUI();
                } else {
                    this.showError('ê±´ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + data.message);
                }
            })
            .catch(error => {
                console.error('ğŸ¢ ê±´ë¬¼ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                this.showError('ê±´ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        },
        
        // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
        populateForm: function(data) {
            // ê±´ë¬¼ê°œìš” ë°ì´í„°
            const fields = [
                'name', 'landlord', 'design', 'builder', 'address1', 'area_total', 'class_land',
                'district', 'section', 'area_bl', 'parcel', 'bl_to_land_ratio', 'fl_space_index',
                'area_usable', 'construction_type', 'roof_type', 'count_fl', 'count_bf',
                'bl_height', 'bl_depth', 'use1', 'date_bl', 'parking_type', 'elev_type',
                'elec_type', 'generator_type', 'heating_type', 'cooling_type', 'contact_name',
                'contact_phone', 'contact_fax', 'zip'
            ];
            
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    element.value = data[field] || '';
                }
            });
            
            // ê¸°íƒ€ì •ë³´ ë°ì´í„°
            const otherFields = [
                'date_buy', 'date_buy_land', 'date_sailed', 'date_manage_start', 'price_pa_land',
                'area_fl', 'area_bf', 'area_rentable', 'area_garden', 'price_book_value',
                'base_rate', 'width_front_road', 'width_back_road', 'width_side_road',
                'parking_unit_inner', 'parking_unit_outdoor', 'el_unit', 'es_unit', 'comments'
            ];
            
            otherFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    element.value = data[field] || '';
                }
            });
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì²˜ë¦¬
            this.setRadioValue('regist', data.regist);
            this.setRadioValue('use_fl_4', data.use_fl_4);
            this.setRadioValue('use_fl_13', data.use_fl_13);
            this.setRadioValue('ph', data.ph);
            
            // í‰ìˆ˜ ê³„ì‚°
            this.calculatePyeong();
        },
        
        // ë¼ë””ì˜¤ ë²„íŠ¼ ê°’ ì„¤ì •
        setRadioValue: function(name, value) {
            const radios = document.querySelectorAll(`input[name="${name}"]`);
            radios.forEach(radio => {
                radio.checked = radio.value === String(value);
            });
        },
        
        // í‰ìˆ˜ ê³„ì‚°
        calculatePyeong: function() {
            const areaTotalInput = document.getElementById('area_total');
            const areaTotalPyeongInput = document.getElementById('area_total_pyeong');
            
            if (areaTotalInput && areaTotalPyeongInput) {
                const areaTotal = parseFloat(areaTotalInput.value.replace(/,/g, '')) || 0;
                const pyeong = areaTotal / 3.3058;
                areaTotalPyeongInput.value = pyeong > 0 ? pyeong.toFixed(2) : '';
            }
        },
        
        // íƒ­ ì „í™˜
        showTab: function(tabNumber, element) {
            // ê¸°ì¡´ íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ìƒˆ íƒ­ í™œì„±í™”
            if (element) element.classList.add('active');
            const tabContent = document.getElementById(`tab${tabNumber}_content`);
            if (tabContent) tabContent.classList.add('active');
            
            this.data.currentTab = tabNumber;
            document.getElementById('current_tab').value = tabNumber;
            
            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            if (this.data.currentBlId) {
                if (tabNumber === 3) {
                    this.loadHistoryData();
                } else if (tabNumber === 4) {
                    this.loadPhotoData();
                }
            }
        },
        
        // ì´ë ¥ ë°ì´í„° ë¡œë“œ
        loadHistoryData: function() {
            if (!this.data.currentBlId) return;
            
            const historyType = document.getElementById('history_type').value;
            const dateStart = document.getElementById('history_date_start').value;
            const dateEnd = document.getElementById('history_date_end').value;
            const keyword = document.getElementById('history_search').value;
            
            fetch('/fm/bl_update/get_history_data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    bl_id: this.data.currentBlId,
                    type: historyType,
                    date_start: dateStart,
                    date_end: dateEnd,
                    keyword: keyword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.renderHistoryTable(data.data);
                } else {
                    this.showHistoryError('ì´ë ¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ğŸ¢ ì´ë ¥ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                this.showHistoryError('ì´ë ¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        },
        
        // ì´ë ¥ í…Œì´ë¸” ë Œë”ë§
        renderHistoryTable: function(data) {
            const tbody = document.getElementById('history_table_body');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">ë“±ë¡ëœ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            let html = '';
            data.forEach(item => {
                html += `
                    <tr onclick="BlUpdateModule.openHistoryDetail(${item.auto_number || 0}, '${this.data.currentBlId}', '${item.type || '2'}')" style="cursor: pointer;">
                        <td style="text-align:left; padding-left:5px;">${item.title || ''}</td>
                        <td style="text-align:center;">${item.reg_man_name || item.reg_man || ''}</td>
                        <td style="text-align:center;">${item.reg_date || ''}</td>
                        <td style="text-align:center;">${item.filename ? 'ğŸ“' : ''}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        },
            
        
        // ì‚¬ì§„ ë°ì´í„° ë¡œë“œ
        loadPhotoData: function() {
            if (!this.data.currentBlId) return;
            
            const dateStart = document.getElementById('photo_date_start').value;
            const dateEnd = document.getElementById('photo_date_end').value;
            const keyword = document.getElementById('photo_search').value;
            
            fetch('/fm/bl_update/get_photo_data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    bl_id: this.data.currentBlId,
                    date_start: dateStart,
                    date_end: dateEnd,
                    keyword: keyword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.data.photoData = data.data;
                    this.renderPhotoTable(data.data);
                } else {
                    this.showPhotoError('ì‚¬ì§„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ğŸ¢ ì‚¬ì§„ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                this.showPhotoError('ì‚¬ì§„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        },
        
        // ì‚¬ì§„ í…Œì´ë¸” ë Œë”ë§
        renderPhotoTable: function(data) {
            const tbody = document.getElementById('photo_table_body');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            let html = '';
            data.forEach((item, index) => {
                const mainIndicator = item.is_main_photo ? '<span class="main-photo-indicator">[ë©”ì¸]</span> ' : '';
                html += `
                    <tr onclick="BlUpdateModule.selectPhoto(${index})" style="cursor: pointer;">
                        <td style="text-align:left; padding-left:5px;">${mainIndicator}${item.title || ''}</td>
                        <td style="text-align:center;">${item.reg_man_name || item.reg_man || ''}</td>
                        <td style="text-align:center;">${item.reg_date || ''}</td>
                        <td style="text-align:center;">${item.filename ? 'ğŸ“·' : ''}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        },
        
        // ì‚¬ì§„ ì„ íƒ
        selectPhoto: function(index) {
            if (index >= 0 && index < this.data.photoData.length) {
                this.data.selectedPhotoIndex = index;
                const photo = this.data.photoData[index];
                
                document.getElementById('photo_title').textContent = photo.title || 'ì œëª© ì—†ìŒ';
                
                if (photo.maskname) {
                    document.getElementById('photo_image').src = `/fm/bl_update/view_file?auto_number=${photo.auto_number}`;
                } else {
                    document.getElementById('photo_image').src = '/static/images/common/no_image.png';
                }
            }
        },
        
        // ì´ì „ ì‚¬ì§„
        prevPhoto: function() {
            if (this.data.selectedPhotoIndex > 0) {
                this.selectPhoto(this.data.selectedPhotoIndex - 1);
            }
        },
        
        // ë‹¤ìŒ ì‚¬ì§„
        nextPhoto: function() {
            if (this.data.selectedPhotoIndex < this.data.photoData.length - 1) {
                this.selectPhoto(this.data.selectedPhotoIndex + 1);
            }
        },
        
        // ê±´ë¬¼ ë°ì´í„° ì €ì¥
        saveBlData: function() {
            if (!this.data.currentBlId) {
                alert('ì €ì¥í•  ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!this.data.hasPermission) {
                alert('í•´ë‹¹ ê±´ë¬¼ì˜ ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = this.collectFormData();
            formData.bl_id = this.data.currentBlId;
            formData.em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
            
            console.log('ğŸ¢ ì €ì¥í•  ë°ì´í„°:', formData);
            
            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const saveBtn = document.getElementById('btn_save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'ì €ì¥ ì¤‘...';
            saveBtn.disabled = true;
            
            fetch('/fm/bl_update/save_bl_data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.showSuccess('ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ì €ì¥ ì‹¤íŒ¨: ' + data.message);
                }
            })
            .catch(error => {
                console.error('ğŸ¢ ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            })
            .finally(() => {
                // ì €ì¥ ë²„íŠ¼ ë³µì›
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            });
        },
        
        // í¼ ë°ì´í„° ìˆ˜ì§‘
        collectFormData: function() {
            const data = {};
            
            // ëª¨ë“  ì…ë ¥ í•„ë“œ
            const inputs = document.querySelectorAll('#bl_update_outer input, #bl_update_outer select, #bl_update_outer textarea');
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        data[input.name] = input.value;
                    }
                } else if (input.id && input.id !== 'current_bl_id' && input.id !== 'current_prop_id' && input.id !== 'current_tab') {
                    data[input.id] = input.value;
                }
            });
            
            return data;
        },
        
        // ë©”ì¸ì‚¬ì§„ ì‚­ì œ
        deleteMainPhoto: function() {
            if (!this.data.currentBlId) {
                alert('ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!confirm('ë©”ì¸ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            fetch('/fm/bl_update/delete_main_photo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ bl_id: this.data.currentBlId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.showSuccess('ë©”ì¸ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // ì‚¬ì§„ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
                    if (this.data.currentTab === 4) {
                        this.loadPhotoData();
                    }
                } else {
                    alert('ë©”ì¸ì‚¬ì§„ ì‚­ì œ ì‹¤íŒ¨: ' + data.message);
                }
            })
            .catch(error => {
                console.error('ğŸ¢ ë©”ì¸ì‚¬ì§„ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ë©”ì¸ì‚¬ì§„ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        },
        
        // ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
        exportExcel: function() {
            if (!this.data.currentBlId) {
                alert('ì—‘ì…€ë¡œ ë‚´ë³´ë‚¼ ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const downloadUrl = `/fm/bl_update/export_excel?bl_id=${this.data.currentBlId}`;
            window.open(downloadUrl, '_blank');
            
            this.showSuccess('ì—‘ì…€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.');
        },
        
        // ì¸ì‡„
        printBl: function() {
            if (!this.data.currentBlId) {
                alert('ì¸ì‡„í•  ê±´ë¬¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            window.print();
        },
        
        // ëª©ë¡ìœ¼ë¡œ ì´ë™
        goToBlList: function() {
            if (typeof window.loadContent === 'function') {
                window.loadContent('/fm/bl_list.html', 'ê±´ë¬¼ì •ë³´');
                window.showStatus && window.showStatus('ê±´ë¬¼ ëª©ë¡ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.');
            }
        },
        
        // ì´ë ¥ ë“±ë¡
        registerHistory: function() {
            alert('ì´ë ¥ ë“±ë¡ ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        },
        
        // ì‚¬ì§„ ë“±ë¡
        registerPhoto: function() {
            alert('ì‚¬ì§„ ë“±ë¡ ê¸°ëŠ¥ì„ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.');
        },
        
        // ê¶Œí•œ UI ì—…ë°ì´íŠ¸
        updatePermissionUI: function() {
            const saveBtn = document.getElementById('btn_save');
            const deleteBtn = document.getElementById('btn_delete_photo');
            
            if (!this.data.hasPermission) {
                if (saveBtn) {
                    saveBtn.disabled = true;
                    saveBtn.title = 'ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
                }
                if (deleteBtn) {
                    deleteBtn.disabled = true;
                    deleteBtn.title = 'ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
                }
                
                // ì…ë ¥ í•„ë“œ ì½ê¸° ì „ìš© ì„¤ì •
                const inputs = document.querySelectorAll('#bl_update_outer input, #bl_update_outer select, #bl_update_outer textarea');
                inputs.forEach(input => {
                    if (input.type !== 'button' && input.type !== 'submit') {
                        input.readOnly = true;
                    }
                });
            }
        },
        
        // í¼ ì´ˆê¸°í™”
        clearForm: function() {
            this.data.currentBlId = null;
            document.getElementById('current_bl_id').value = '';
            
            // ëª¨ë“  ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            const inputs = document.querySelectorAll('#bl_update_outer input, #bl_update_outer select, #bl_update_outer textarea');
            inputs.forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    input.checked = false;
                } else if (input.type !== 'button' && input.type !== 'submit') {
                    input.value = '';
                }
            });
        },
        
        // ë¡œë”© í‘œì‹œ
        showLoading: function(message = 'ë¡œë”© ì¤‘...') {
            // ê°„ë‹¨í•œ ë¡œë”© í‘œì‹œ
            console.log('ğŸ¢ ë¡œë”©:', message);
        },
        
        // ë¡œë”© ìˆ¨ê¹€
        hideLoading: function() {
            console.log('ğŸ¢ ë¡œë”© ì™„ë£Œ');
        },
        
        // ì˜¤ë¥˜ í‘œì‹œ
        showError: function(message) {
            console.error('ğŸ¢ ì˜¤ë¥˜:', message);
            alert(message);
        },
        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        showSuccess: function(message) {
            console.log('ğŸ¢ ì„±ê³µ:', message);
            if (window.showStatus) {
                window.showStatus(message);
            } else {
                alert(message);
            }
        },
        
        // ì´ë ¥ í…Œì´ë¸” ì˜¤ë¥˜ í‘œì‹œ
        showHistoryError: function(message) {
            const tbody = document.getElementById('history_table_body');
            tbody.innerHTML = `<tr><td colspan="4" class="text-center text-danger">${message}</td></tr>`;
        },
        
        // ì‚¬ì§„ í…Œì´ë¸” ì˜¤ë¥˜ í‘œì‹œ
        showPhotoError: function(message) {
            const tbody = document.getElementById('photo_table_body');
            tbody.innerHTML = `<tr><td colspan="4" class="text-center text-danger">${message}</td></tr>`;
        },
        // ì‚¬ì§„ í…Œì´ë¸” ì˜¤ë¥˜ í‘œì‹œ
        showPhotoError: function(message) {
            const tbody = document.getElementById('photo_table_body');
            tbody.innerHTML = `<tr><td colspan="4" class="text-center text-danger">${message}</td></tr>`;
        },
        
        // ì´ë ¥ ìƒì„¸ ì—´ê¸° (blpds_updateë¡œ ì´ë™)
        openHistoryDetail: function(autoNumber, blId, type) {
            console.log('ğŸ¢ ì´ë ¥ ìƒì„¸ ì—´ê¸°:', { autoNumber, blId, type });
            
            if (!autoNumber || autoNumber === 0) {
                alert('ì˜ëª»ëœ ì´ë ¥ ì •ë³´ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (blpds_updateì—ì„œ ì‚¬ìš©)
            window.selected_auto_number = autoNumber;
            window.selected_bl_id = blId || this.data.currentBlId;
            window.selected_file_type = type || '2';
            
            console.log('ğŸ¢ ì„¤ì •ëœ ì „ì—­ ë³€ìˆ˜:', {
                selected_auto_number: window.selected_auto_number,
                selected_bl_id: window.selected_bl_id,
                selected_file_type: window.selected_file_type
            });
            
            // blpds_update íƒ­ìœ¼ë¡œ ì´ë™
            if (typeof window.loadContent === 'function') {
                window.loadContent('/fm/blpds_update.html', `ê±´ë¬¼ì´ë ¥ìƒì„¸(${autoNumber})`);
                window.showStatus && window.showStatus('ê±´ë¬¼ì´ë ¥ ìƒì„¸ í˜ì´ì§€ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                console.error('ğŸ¢ loadContent í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        },
        
        // ì‚¬ì§„ í…Œì´ë¸” ë Œë”ë§ (ê¸°ì¡´ì— ì—†ë˜ í•¨ìˆ˜)
        renderPhotoTable: function(data) {
            const tbody = document.getElementById('photo_table_body');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            let html = '';
            data.forEach((item, index) => {
                const mainIndicator = item.is_main_photo ? '<span class="main-photo-indicator">[ë©”ì¸]</span> ' : '';
                html += `
                    <tr onclick="BlUpdateModule.selectPhoto(${index})" ondblclick="BlUpdateModule.openHistoryDetail(${item.auto_number || 0}, '${this.data.currentBlId}', '1')" style="cursor: pointer;">
                        <td style="text-align:left; padding-left:5px;">${mainIndicator}${item.title || ''}</td>
                        <td style="text-align:center;">${item.reg_man_name || item.reg_man || ''}</td>
                        <td style="text-align:center;">${item.reg_date || ''}</td>
                        <td style="text-align:center;">${item.filename ? 'ğŸ“·' : ''}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
    
    };
    
    // ì „ì—­ ì´ˆê¸°í™” í•¨ìˆ˜ ë“±ë¡
    window.initBlUpdatePage = function() {
        window.BlUpdateModule.init();
    };
    
    // ìë™ ì´ˆê¸°í™” (ì¦‰ì‹œ ì‹¤í–‰)
    setTimeout(() => {
        if (!window.BlUpdateModule.data.isInitialized) {
            console.log('ğŸ¢ ìë™ ì´ˆê¸°í™” ì‹œì‘');
            window.BlUpdateModule.init();
        }
    }, 500);
    
    console.log('ğŸ¢ BlUpdateModule ë¡œë“œ ì™„ë£Œ');
    
})(); // ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ ë
</script>