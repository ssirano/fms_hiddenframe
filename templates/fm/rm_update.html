<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì •ë³´ ìˆ˜ì •</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/common_modal.css">
    <style>
        /* rm_update ìŠ¤íƒ€ì¼ */
        #rm_update_outer {
            padding: 20px;
            padding-bottom: 0;
            overflow-y: auto;
            background-color: #f8f9fa;
            font-size: 12px;
        }

        /* ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ */
        #rm_update_outer .top-buttons {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        #rm_update_outer .top-buttons button {
            height: 32px;
            padding: 0 16px;
            background: #fff;
            color: #333;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
        }

        #rm_update_outer .top-buttons button:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }

        #rm_update_outer .top-buttons button.btn-primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        #rm_update_outer .top-buttons button.btn-primary:hover {
            background: #0056b3;
            border-color: #004085;
        }

        #rm_update_outer .top-buttons button.btn-danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        #rm_update_outer .top-buttons button.btn-danger:hover {
            background: #c82333;
            border-color: #bd2130;
        }

        /* ì‹¤ì •ë³´ ì˜ì—­ */
        #rm_update_outer .room-info-area {
            background-color: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            padding: 20px;
            margin-bottom: 15px;
        }

        #rm_update_outer .room-info-table {
            width: 100%;
            border-collapse: collapse;
        }

        #rm_update_outer .room-info-table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            font-size: 12px;
        }

        #rm_update_outer .room-info-table .label-cell {
            background-color: #f7f7f7;
            text-align: center;
            font-weight: bold;
            width: 15%;
        }

        #rm_update_outer .room-info-table .value-cell {
            background-color: white;
            text-align: left;
            width: 35%;
            padding-left: 15px;
        }

        #rm_update_outer .room-info-table input[type="text"] {
            width: 200px;
            height: 32px;
            padding: 0 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 12px;
        }

        #rm_update_outer .room-info-table input[readonly] {
            background-color: #f8f9fa;
            color: #6c757d;
        }

        /* ì…ì£¼ì‚¬ ì •ë³´ ì˜ì—­ */
        #rm_update_outer .tenant-area {
            background-color: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 400px);
        }

        /* ì…ì£¼ì‚¬ ê²€ìƒ‰ ì˜ì—­ */
        #rm_update_outer .tenant-search-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        #rm_update_outer .tenant-search-left {
            font-size: 14px;
            font-weight: bold;
            color: #495057;
        }

        #rm_update_outer .tenant-search-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #rm_update_outer .tenant-search-right input[type="checkbox"] {
            margin-right: 5px;
        }

        #rm_update_outer .tenant-search-right input[type="text"] {
            height: 32px;
            padding: 0 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            width: 150px;
            font-size: 12px;
        }

        #rm_update_outer .tenant-search-right button {
            height: 32px;
            padding: 0 12px;
            background: #007bff;
            color: white;
            border: 1px solid #007bff;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        #rm_update_outer .tenant-search-right button:hover {
            background: #0056b3;
            border-color: #004085;
        }

        /* ì…ì£¼ì‚¬ í…Œì´ë¸” ì˜ì—­ */
        #rm_update_outer .tenant-table-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #rm_update_outer .tenant-table {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }

        #rm_update_outer .tenant-table .table-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
            font-size: 12px;
            height: 40px;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        #rm_update_outer .tenant-table .header-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border-right: 1px solid #dee2e6;
        }

        #rm_update_outer .tenant-table .header-cell:last-child {
            border-right: none;
        }

        #rm_update_outer .tenant-table .table-content {
            display: block;
        }

        #rm_update_outer .tenant-table .table-row {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
            transition: background-color 0.15s ease;
            min-height: 36px;
            align-items: center;
        }

        #rm_update_outer .tenant-table .table-row:hover {
            background-color: #f8f9fa;
        }

        #rm_update_outer .tenant-table .table-cell {
            display: flex;
            align-items: center;
            padding: 8px;
            border-right: 1px solid #dee2e6;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #rm_update_outer .tenant-table .table-cell:last-child {
            border-right: none;
        }

        /* í…ìŠ¤íŠ¸ ì •ë ¬ */
        #rm_update_outer .tenant-table .text-center { justify-content: center; }
        #rm_update_outer .tenant-table .text-left { justify-content: flex-start; }

        /* ì»¬ëŸ¼ ë„ˆë¹„ */
        #rm_update_outer .tenant-table .col-tenant { width: 20%; }
        #rm_update_outer .tenant-table .col-move-in { width: 15%; }
        #rm_update_outer .tenant-table .col-move-out { width: 15%; }
        #rm_update_outer .tenant-table .col-comments { width: 50%; }

        /* ë¹ˆ ë°ì´í„° ë©”ì‹œì§€ */
        #rm_update_outer .tenant-table .empty-message {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            color: #6c757d;
            font-size: 14px;
            border-bottom: none;
        }

        /* ë¡œë”© í‘œì‹œ */
        #rm_update_outer .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 14px;
            color: #6c757d;
        }

        #rm_update_outer .loading .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* í•„ìˆ˜ ì…ë ¥ í‘œì‹œ */
        .required::after {
            content: "*";
            color: red;
            margin-left: 2px;
        }
    </style>
</head>
<body>
    <div id="rm_update_outer">
        <!-- ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ -->
        <div class="top-buttons">
            <button type="button" id="btn_save" class="btn-primary">ì €ì¥</button>
            <button type="button" id="btn_delete" class="btn-danger">ì‚­ì œ</button>
            <button type="button" id="btn_list">ëª©ë¡ë³´ê¸°</button>
        </div>

        <!-- ì‹¤ì •ë³´ ì˜ì—­ -->
        <div class="room-info-area">
            <table class="room-info-table">
                <tr>
                    <td class="label-cell required">ê±´ë¬¼</td>
                    <td class="value-cell">
                        <span id="bl_display">-</span>
                        <input type="hidden" id="bl_id" name="bl_id">
                        <input type="hidden" id="bl_name" name="bl_name">
                    </td>
                    <td class="label-cell required">ì‹¤ì½”ë“œ</td>
                    <td class="value-cell">
                        <input type="text" id="rm_id" name="rm_id" readonly>
                    </td>
                </tr>
                <tr>
                    <td class="label-cell required">ì¸µ</td>
                    <td class="value-cell">
                        <span id="fl_display">-</span>
                        <input type="hidden" id="fl_id" name="fl_id">
                        <input type="hidden" id="fl_name" name="fl_name">
                    </td>
                    <td class="label-cell required">ì‹¤ì´ë¦„</td>
                    <td class="value-cell">
                        <input type="text" id="rm_name" name="rm_name">
                    </td>
                </tr>
            </table>
        </div>

        <!-- ì…ì£¼ì‚¬ ì •ë³´ ì˜ì—­ -->
        <div class="tenant-area">
            <div class="tenant-search-area">
                <div class="tenant-search-left">
                    â€» ì…ì£¼ì‚¬ ì •ë³´
                </div>
                <div class="tenant-search-right">
                    <label>
                        <input type="checkbox" id="cb_move_out" name="cb_move_out">
                        í‡´ì‹¤í¬í•¨
                    </label>
                    <input type="text" id="tenant_search" placeholder="ì…ì£¼ì‚¬ëª…">
                    <button type="button" id="btn_tenant_search">ê²€ìƒ‰</button>
                    <button type="button" id="btn_tenant_register">ì…ì£¼ì‚¬ë“±ë¡</button>
                </div>
            </div>

            <div class="tenant-table-wrapper">
                <div class="tenant-table">
                    <div class="table-header">
                        <div class="header-cell col-tenant text-center">ì…ì£¼ì‚¬</div>
                        <div class="header-cell col-move-in text-center">ì…ì‹¤ì¼ì</div>
                        <div class="header-cell col-move-out text-center">í‡´ì‹¤ì¼ì</div>
                        <div class="header-cell col-comments text-center">ë¹„ê³ </div>
                    </div>

                    <div class="table-content" id="tenant_table_content">
                        <div class="loading">
                            <div class="spinner"></div>
                            ì…ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- íˆë“  í•„ë“œë“¤ -->
        <input type="hidden" id="prop_id_old" name="prop_id_old">
        <input type="hidden" id="bl_id_old" name="bl_id_old">
        <input type="hidden" id="fl_id_old" name="fl_id_old">
        <input type="hidden" id="rm_id_old" name="rm_id_old">
        <input type="hidden" id="prop_id" name="prop_id">
    </div>

    <script>
    // ğŸ›¡ï¸ ì™„ì „í•œ ìŠ¤ì½”í”„ ë¶„ë¦¬
    (function() {
        'use strict';
        
        console.log('ğŸ  rm_update.html ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘!');
        
        // ğŸ”¥ ê¸°ì¡´ RmUpdateModule ì™„ì „ ì œê±° í›„ ì¬ìƒì„±
        if (typeof window.RmUpdateModule !== 'undefined') {
            console.log('ğŸ  ê¸°ì¡´ RmUpdateModule ì™„ì „ ì œê±°');
            if (window.RmUpdateModule.cleanup && typeof window.RmUpdateModule.cleanup === 'function') {
                window.RmUpdateModule.cleanup();
            }
            delete window.RmUpdateModule;
        }
        
        // ëª¨ë“ˆ ìƒì„±
        window.RmUpdateModule = {
            // ë°ì´í„° ì €ì¥ì†Œ
            data: {
                roomInfo: null,
                tenantList: [],
                isInitialized: false,
                includeMovedOut: false,
                tenantSearchKeyword: '',
                moduleId: 'rm_update_' + Date.now(),
                selectedTenantId: null
            },
            
            // ğŸ”§ ì•ˆì „í•œ DOM ì ‘ê·¼ í—¬í¼
            safeGetElement: function(id) {
                try {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.warn('ğŸ  [RU] DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', id);
                    }
                    return element;
                } catch (error) {
                    console.error('ğŸ  [RU] DOM ì ‘ê·¼ ì˜¤ë¥˜:', error);
                    return null;
                }
            },

            // ì´ˆê¸°í™”
            init: function() {
                console.log('ğŸ  [RU] ì‹¤ì •ë³´ ìˆ˜ì • í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');
                
                // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì‹¤ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ìš°ì„ ìˆœìœ„: URL > ì „ì—­ë³€ìˆ˜)
                const urlParams = new URLSearchParams(window.location.search);
                const prop_id = urlParams.get('prop_id') || window.selected_rm_prop_id || window.currentPropId;
                const bl_id = urlParams.get('bl_id') || window.selected_rm_bl_id;
                const fl_id = urlParams.get('fl_id') || window.selected_rm_fl_id;
                const rm_id = urlParams.get('rm_id') || window.selected_rm_id;
                
                console.log('ğŸ  [RU] ë°›ì€ íŒŒë¼ë¯¸í„°:', { prop_id, bl_id, fl_id, rm_id });
                console.log('ğŸ  [RU] URL:', window.location.href);
                console.log('ğŸ  [RU] URLParams:', urlParams.toString());
                
                if (!prop_id || !bl_id || !fl_id || !rm_id) {
                    console.error('ğŸ  [RU] í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½');
                    this.showError('í•„ìˆ˜ íŒŒë¼ë¯¸í„°ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì •ë³´ ëª©ë¡ì—ì„œ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // íˆë“  í•„ë“œì— old ê°’ ì„¤ì •
                const propIdOldElem = this.safeGetElement('prop_id_old');
                const blIdOldElem = this.safeGetElement('bl_id_old');
                const flIdOldElem = this.safeGetElement('fl_id_old');
                const rmIdOldElem = this.safeGetElement('rm_id_old');
                
                if (propIdOldElem) propIdOldElem.value = prop_id;
                if (blIdOldElem) blIdOldElem.value = bl_id;
                if (flIdOldElem) flIdOldElem.value = fl_id;
                if (rmIdOldElem) rmIdOldElem.value = rm_id;
                
                this.data.isInitialized = true;
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                this.bindEvents();
                
                // ì‹¤ì •ë³´ ë¡œë“œ
                this.loadRoomInfo();
                
                // ì…ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
                this.loadTenantList();
            },
            
            // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ì™¸ë¶€ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
            refreshWithNewData: function(prop_id, bl_id, fl_id, rm_id) {
                console.log('ğŸ  [RU] ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ìƒˆë¡œê³ ì¹¨:', { prop_id, bl_id, fl_id, rm_id });
                
                if (!prop_id || !bl_id || !fl_id || !rm_id) {
                    console.error('ğŸ  [RU] ìƒˆë¡œê³ ì¹¨ - í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½');
                    return;
                }
                
                // íˆë“  í•„ë“œ ì—…ë°ì´íŠ¸
                this.safeGetElement('prop_id_old').value = prop_id;
                this.safeGetElement('bl_id_old').value = bl_id;
                this.safeGetElement('fl_id_old').value = fl_id;
                this.safeGetElement('rm_id_old').value = rm_id;
                
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                this.loadRoomInfo();
                this.loadTenantList();
            },
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            bindEvents: function() {
                // ì €ì¥ ë²„íŠ¼
                const btnSave = this.safeGetElement('btn_save');
                if (btnSave) {
                    btnSave.onclick = () => {
                        this.saveRoom();
                    };
                }
                
                // ì‚­ì œ ë²„íŠ¼
                const btnDelete = this.safeGetElement('btn_delete');
                if (btnDelete) {
                    btnDelete.onclick = () => {
                        this.deleteRoom();
                    };
                }
                
                // ëª©ë¡ë³´ê¸° ë²„íŠ¼
                const btnList = this.safeGetElement('btn_list');
                if (btnList) {
                    btnList.onclick = () => {
                        this.goToList();
                    };
                }
                
                // ì…ì£¼ì‚¬ ê²€ìƒ‰ ë²„íŠ¼
                const btnTenantSearch = this.safeGetElement('btn_tenant_search');
                if (btnTenantSearch) {
                    btnTenantSearch.onclick = () => {
                        this.searchTenant();
                    };
                }
                
                // ì…ì£¼ì‚¬ ë“±ë¡ ë²„íŠ¼
                const btnTenantRegister = this.safeGetElement('btn_tenant_register');
                if (btnTenantRegister) {
                    btnTenantRegister.onclick = () => {
                        this.openTenantModal();
                    };
                }
                
                // í‡´ì‹¤í¬í•¨ ì²´í¬ë°•ìŠ¤
                const cbMoveOut = this.safeGetElement('cb_move_out');
                if (cbMoveOut) {
                    cbMoveOut.onchange = () => {
                        this.data.includeMovedOut = cbMoveOut.checked;
                        this.loadTenantList();
                    };
                }
                
                // ì…ì£¼ì‚¬ ê²€ìƒ‰ ì…ë ¥ ì—”í„°í‚¤
                const tenantSearchInput = this.safeGetElement('tenant_search');
                if (tenantSearchInput) {
                    tenantSearchInput.onkeypress = (e) => {
                        if (e.key === 'Enter') {
                            this.searchTenant();
                        }
                    };
                }
                
                // ì‹¤ì´ë¦„ ì…ë ¥ ì—”í„°í‚¤
                const rmNameInput = this.safeGetElement('rm_name');
                if (rmNameInput) {
                    rmNameInput.onkeypress = (e) => {
                        if (e.key === 'Enter') {
                            this.saveRoom();
                        }
                    };
                }
                
                console.log('ğŸ  [RU] ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            },
            
            // ì‹¤ì •ë³´ ë¡œë“œ
            loadRoomInfo: function() {
                const prop_id_old = this.safeGetElement('prop_id_old').value;
                const bl_id_old = this.safeGetElement('bl_id_old').value;
                const fl_id_old = this.safeGetElement('fl_id_old').value;
                const rm_id_old = this.safeGetElement('rm_id_old').value;
                const em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
                
                console.log('ğŸ  [RU] ì‹¤ì •ë³´ ë¡œë“œ ìš”ì²­:', { prop_id_old, bl_id_old, fl_id_old, rm_id_old, em_id });
                
                fetch('fm/rm_update/get_room_info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        em_id: em_id,
                        prop_id: prop_id_old,
                        bl_id: bl_id_old,
                        fl_id: fl_id_old,
                        rm_id: rm_id_old
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì‹¤ì •ë³´ ì‘ë‹µ:', data);
                    if (data && data.success) {
                        this.data.roomInfo = data.data;
                        this.renderRoomInfo(data.data);
                    } else {
                        console.error('ğŸ  [RU] ì‹¤ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', data ? data.message : 'Unknown error');
                        this.showError(`ì‹¤ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${data ? data.message : 'Unknown error'}`);
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì‹¤ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                    this.showError(`ì‹¤ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                });
            },
            
            // ì‹¤ì •ë³´ ë Œë”ë§
            renderRoomInfo: function(roomInfo) {
                this.safeGetElement('prop_id').value = roomInfo.prop_id || '';
                this.safeGetElement('bl_id').value = roomInfo.bl_id || '';
                this.safeGetElement('bl_name').value = roomInfo.bl_name || '';
                this.safeGetElement('fl_id').value = roomInfo.fl_id || '';
                this.safeGetElement('fl_name').value = roomInfo.fl_name || '';
                this.safeGetElement('rm_id').value = roomInfo.rm_id || '';
                this.safeGetElement('rm_name').value = roomInfo.rm_name || '';
                
                // í‘œì‹œìš© í…ìŠ¤íŠ¸ ì„¤ì •
                const blDisplay = this.safeGetElement('bl_display');
                const flDisplay = this.safeGetElement('fl_display');
                
                if (blDisplay) {
                    blDisplay.textContent = roomInfo.bl_name ? `${roomInfo.bl_name}(${roomInfo.bl_id})` : '-';
                }
                if (flDisplay) {
                    flDisplay.textContent = roomInfo.fl_name ? `${roomInfo.fl_name}(${roomInfo.fl_id})` : '-';
                }
                
                console.log('ğŸ  [RU] ì‹¤ì •ë³´ ë Œë”ë§ ì™„ë£Œ');
            },
            
            // ì…ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
            loadTenantList: function() {
                const prop_id_old = this.safeGetElement('prop_id_old').value;
                const bl_id_old = this.safeGetElement('bl_id_old').value;
                const fl_id_old = this.safeGetElement('fl_id_old').value;
                const rm_id_old = this.safeGetElement('rm_id_old').value;
                const em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
                
                this.showTenantLoading();
                
                const requestData = {
                    em_id: em_id,
                    prop_id: prop_id_old,
                    bl_id: bl_id_old,
                    fl_id: fl_id_old,
                    rm_id: rm_id_old,
                    include_moved_out: this.data.includeMovedOut,
                    keyword: this.data.tenantSearchKeyword
                };
                
                console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ëª©ë¡ ìš”ì²­:', requestData);
                
                fetch('fm/rm_update/get_tenant_list', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ëª©ë¡ ì‘ë‹µ:', data);
                    if (data && data.success) {
                        this.data.tenantList = data.data || [];
                        this.renderTenantTable(data.data || []);
                    } else {
                        console.error('ğŸ  [RU] ì…ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', data ? data.message : 'Unknown error');
                        this.renderTenantTable([]);
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì…ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                    this.renderTenantTable([]);
                });
            },
            
            // ì…ì£¼ì‚¬ í…Œì´ë¸” ë Œë”ë§
            renderTenantTable: function(tenantData) {
                const tableContent = this.safeGetElement('tenant_table_content');
                if (!tableContent) return;

                if (!tenantData || tenantData.length === 0) {
                    tableContent.innerHTML = `
                        <div class="empty-message">
                            ì…ì£¼ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                tenantData.forEach(tenant => {
                    html += `
                        <div class="table-row" 
                            data-rmtenant-id="${tenant.rmtenant_id}"
                            onclick="RmUpdateModule.selectTenant('${tenant.rmtenant_id}')">
                            <div class="table-cell col-tenant text-left">${tenant.tenant_name || ''}</div>
                            <div class="table-cell col-move-in text-center">${tenant.move_in || ''}</div>
                            <div class="table-cell col-move-out text-center">${tenant.move_out || ''}</div>
                            <div class="table-cell col-comments text-left">${tenant.comments || ''}</div>
                        </div>
                    `;
                });
                
                tableContent.innerHTML = html;
            },
            
            // ì…ì£¼ì‚¬ ì„ íƒ (í´ë¦­ ì‹œ ìˆ˜ì • ëª¨ë‹¬)
            selectTenant: function(rmtenantId) {
                console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ì„ íƒë¨:', rmtenantId);
                this.data.selectedTenantId = rmtenantId;
                this.openTenantModal(rmtenantId);
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ì—´ê¸°
            openTenantModal: function(rmtenantId = null) {
                console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ëª¨ë‹¬ ì—´ê¸°:', rmtenantId);
                
                const bl_id_old = this.safeGetElement('bl_id_old').value;
                const fl_id_old = this.safeGetElement('fl_id_old').value;
                const rm_id_old = this.safeGetElement('rm_id_old').value;
                const prop_id_old = this.safeGetElement('prop_id_old').value;
                
                if (!bl_id_old || !fl_id_old || !rm_id_old) {
                    alert('ì‹¤ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ëª¨ë‹¬ ìƒì„±
                this.createTenantModal(rmtenantId, {
                    prop_id: prop_id_old,
                    bl_id: bl_id_old,
                    fl_id: fl_id_old,
                    rm_id: rm_id_old
                });
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ìƒì„±
            createTenantModal: function(rmtenantId, roomInfo) {
                // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
                const existingModal = document.getElementById('tenant_modal_overlay');
                if (existingModal) {
                    existingModal.remove();
                }
                
                const isEditMode = !!rmtenantId;
                const modalTitle = isEditMode ? 'ì…ì£¼ì‚¬ ìˆ˜ì •' : 'ì…ì£¼ì‚¬ ë“±ë¡';
                
                // ëª¨ë‹¬ HTML ìƒì„±
                const modalHTML = `
                    <div id="tenant_modal_overlay" class="modal-overlay">
                        <div id="tenant_modal_content" class="modal-content">
                            <!-- ëª¨ë‹¬ í—¤ë” -->
                            <div class="modal-header">
                                <h3 class="modal-title">${modalTitle}</h3>
                                <div class="modal-controls">
                                    <button type="button" class="modal-control-btn" id="tenant_modal_maximize" title="ìµœëŒ€í™”">â¬œ</button>
                                    <button type="button" class="modal-control-btn close" id="tenant_modal_close" title="ë‹«ê¸°">&times;</button>
                                </div>
                            </div>

                            <!-- ëª¨ë‹¬ ë³¸ë¬¸ -->
                            <div class="modal-body">
                                <!-- ì‹¤ì •ë³´ í‘œì‹œ -->
                                <div class="modal-message" style="background-color: #f8f9fa; color: #495057; border: 1px solid #dee2e6;">
                                    <strong>ì‹¤ì •ë³´:</strong> ${roomInfo.bl_id}(${roomInfo.bl_name || ''}) > ${roomInfo.fl_id}(${roomInfo.fl_name || ''}) > ${roomInfo.rm_id}(${roomInfo.rm_name || ''})
                                </div>
                                
                                <form id="tenant_modal_form">
                                    <table class="modal-form-table">
                                        <tr>
                                            <td class="label-cell modal-required">ì…ì£¼ì‚¬</td>
                                            <td class="value-cell">
                                                <input type="text" id="tenant_name" name="tenant_name" placeholder="ì…ì£¼ì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                                            </td>
                                            <td class="label-cell">ë¹„ê³ </td>
                                            <td class="value-cell">
                                                <input type="text" id="tenant_comments" name="comments" placeholder="ë¹„ê³ ">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label-cell">ì…ì ì¼</td>
                                            <td class="value-cell">
                                                <div class="modal-date-input">
                                                    <input type="date" id="tenant_move_in" name="move_in">
                                                </div>
                                            </td>
                                            <td class="label-cell">í‡´ì ì¼</td>
                                            <td class="value-cell">
                                                <div class="modal-date-input">
                                                    <input type="date" id="tenant_move_out" name="move_out">
                                                </div>
                                            </td>
                                        </tr>
                                    </table>

                                    <!-- íˆë“  í•„ë“œë“¤ -->
                                    <input type="hidden" id="tenant_rmtenant_id" name="rmtenant_id" value="${rmtenantId || ''}">
                                    <input type="hidden" id="tenant_prop_id" name="prop_id" value="${roomInfo.prop_id}">
                                    <input type="hidden" id="tenant_bl_id" name="bl_id" value="${roomInfo.bl_id}">
                                    <input type="hidden" id="tenant_fl_id" name="fl_id" value="${roomInfo.fl_id}">
                                    <input type="hidden" id="tenant_rm_id" name="rm_id" value="${roomInfo.rm_id}">
                                </form>
                            </div>

                            <!-- ëª¨ë‹¬ í‘¸í„° -->
                            <div class="modal-footer">
                                <button type="button" id="tenant_modal_save" class="modal-btn modal-btn-primary">ì €ì¥</button>
                                ${isEditMode ? '<button type="button" id="tenant_modal_delete" class="modal-btn modal-btn-danger">ì‚­ì œ</button>' : ''}
                                <button type="button" id="tenant_modal_cancel" class="modal-btn modal-btn-secondary">ì·¨ì†Œ</button>
                            </div>
                            
                            <!-- ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ -->
                            <div class="modal-resize-handle"></div>
                        </div>
                    </div>
                `;
                
                // bodyì— ì¶”ê°€
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                
                // ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
                this.initializeTenantModal(rmtenantId, roomInfo);
                
                // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ (ìˆ˜ì • ëª¨ë“œì¸ ê²½ìš°)
                if (rmtenantId) {
                    this.loadTenantModalData(rmtenantId);
                } else {
                    // ë“±ë¡ ëª¨ë“œ - ì…ì£¼ì‚¬ëª…ì— í¬ì»¤ìŠ¤
                    setTimeout(() => {
                        document.getElementById('tenant_name').focus();
                    }, 100);
                }
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initializeTenantModal: function(rmtenantId, roomInfo) {
                const self = this;
                
                // ë‹«ê¸° ë²„íŠ¼
                document.getElementById('tenant_modal_close').onclick = function() {
                    self.closeTenantModal();
                };
                
                // ì·¨ì†Œ ë²„íŠ¼
                document.getElementById('tenant_modal_cancel').onclick = function() {
                    self.closeTenantModal();
                };
                
                // ì €ì¥ ë²„íŠ¼
                document.getElementById('tenant_modal_save').onclick = function() {
                    self.saveTenantModal();
                };
                
                // ì‚­ì œ ë²„íŠ¼ (ìˆ˜ì • ëª¨ë“œë§Œ)
                const deleteBtn = document.getElementById('tenant_modal_delete');
                if (deleteBtn) {
                    deleteBtn.onclick = function() {
                        self.deleteTenantModal();
                    };
                }
                
                // ìµœëŒ€í™” ë²„íŠ¼
                document.getElementById('tenant_modal_maximize').onclick = function() {
                    self.toggleTenantModalMaximize();
                };
                
                // ì˜¤ë²„ë ˆì´ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
                document.getElementById('tenant_modal_overlay').onclick = function(event) {
                    if (event.target === this) {
                        self.closeTenantModal();
                    }
                };
                
                // ESC í‚¤ë¡œ ë‹«ê¸°
                this.tenantModalKeyHandler = function(event) {
                    if (event.key === 'Escape') {
                        self.closeTenantModal();
                    }
                };
                document.addEventListener('keydown', this.tenantModalKeyHandler);
                
                // ë“œë˜ê·¸ ê¸°ëŠ¥ ì´ˆê¸°í™”
                this.initializeTenantModalDrag();
                
                // ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥ ì´ˆê¸°í™”
                this.initializeTenantModalResize();
                
                // ì—”í„°í‚¤ ì²˜ë¦¬
                const form = document.getElementById('tenant_modal_form');
                form.onkeypress = function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        self.saveTenantModal();
                    }
                };
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ë°ì´í„° ë¡œë“œ (ìˆ˜ì • ëª¨ë“œ)
            loadTenantModalData: function(rmtenantId) {
                const em_id = window.currentEmId || (window.userInfo && window.userInfo.em_id);
                
                console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ë°ì´í„° ë¡œë“œ:', rmtenantId);
                
                fetch('fm/rm_tenant/get_tenant_info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        em_id: em_id,
                        rmtenant_id: rmtenantId
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ë°ì´í„° ì‘ë‹µ:', data);
                    if (data && data.success) {
                        this.populateTenantModal(data.data);
                    } else {
                        console.error('ğŸ  [RU] ì…ì£¼ì‚¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', data ? data.message : 'Unknown error');
                        alert('ì…ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + (data ? data.message : 'Unknown error'));
                        this.closeTenantModal();
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì…ì£¼ì‚¬ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    alert('ì…ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    this.closeTenantModal();
                });
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ì— ë°ì´í„° ì±„ìš°ê¸°
            populateTenantModal: function(data) {
                document.getElementById('tenant_name').value = data.tenant_name || '';
                document.getElementById('tenant_move_in').value = data.move_in || '';
                document.getElementById('tenant_move_out').value = data.move_out || '';
                document.getElementById('tenant_comments').value = data.comments || '';
                
                // ì…ì£¼ì‚¬ëª…ì— í¬ì»¤ìŠ¤
                setTimeout(() => {
                    document.getElementById('tenant_name').focus();
                }, 100);
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ì €ì¥
            saveTenantModal: function() {
                const tenantName = document.getElementById('tenant_name').value.trim();
                const moveIn = document.getElementById('tenant_move_in').value;
                const moveOut = document.getElementById('tenant_move_out').value;
                const comments = document.getElementById('tenant_comments').value.trim();
                const rmtenantId = document.getElementById('tenant_rmtenant_id').value;
                
                // ìœ íš¨ì„± ê²€ì‚¬
                if (!tenantName) {
                    alert('ì…ì£¼ì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    document.getElementById('tenant_name').focus();
                    return;
                }
                
                // í‡´ì ì¼ì´ ì…ì ì¼ë³´ë‹¤ ë¹ ë¥¸ì§€ ì²´í¬
                if (moveIn && moveOut && moveIn > moveOut) {
                    alert('í‡´ì ì¼ì´ ì…ì ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    document.getElementById('tenant_move_out').focus();
                    return;
                }
                
                const isEditMode = !!rmtenantId;
                const confirmMessage = isEditMode ? 
                    `ì…ì£¼ì‚¬: ${tenantName}\n\nì…ì£¼ì‚¬ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?` :
                    `ì…ì£¼ì‚¬: ${tenantName}\n\nì…ì£¼ì‚¬ë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                // ìš”ì²­ ë°ì´í„° ìƒì„±
                const requestData = {
                    em_id: window.currentEmId || (window.userInfo && window.userInfo.em_id),
                    tenant_name: tenantName,
                    move_in: moveIn || null,
                    move_out: moveOut || null,
                    comments: comments,
                    prop_id: document.getElementById('tenant_prop_id').value,
                    bl_id: document.getElementById('tenant_bl_id').value,
                    fl_id: document.getElementById('tenant_fl_id').value,
                    rm_id: document.getElementById('tenant_rm_id').value
                };
                
                if (isEditMode) {
                    requestData.rmtenant_id = rmtenantId;
                }
                
                console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ì €ì¥ ìš”ì²­:', requestData);
                
                // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
                const saveBtn = document.getElementById('tenant_modal_save');
                const originalText = saveBtn.textContent;
                saveBtn.textContent = 'ì €ì¥ ì¤‘...';
                saveBtn.disabled = true;
                
                // API í˜¸ì¶œ
                const endpoint = isEditMode ? 'fm/rm_tenant/update_tenant' : 'fm/rm_tenant/save_tenant';
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ì €ì¥ ì‘ë‹µ:', data);
                    if (data && data.success) {
                        alert(isEditMode ? 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        this.closeTenantModal();
                        // ì…ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        this.loadTenantList();
                    } else {
                        alert(`ì €ì¥ ì‹¤íŒ¨: ${data ? data.message : 'Unknown error'}`);
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì…ì£¼ì‚¬ ì €ì¥ ì˜¤ë¥˜:', error);
                    alert(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                })
                .finally(() => {
                    // ì €ì¥ ë²„íŠ¼ ë³µì›
                    saveBtn.textContent = originalText;
                    saveBtn.disabled = false;
                });
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ì‚­ì œ
            deleteTenantModal: function() {
                const rmtenantId = document.getElementById('tenant_rmtenant_id').value;
                const tenantName = document.getElementById('tenant_name').value.trim();
                
                if (!rmtenantId) {
                    alert('ì‚­ì œí•  ì…ì£¼ì‚¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                if (!confirm(`ì…ì£¼ì‚¬: ${tenantName}\n\nì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    return;
                }
                
                const requestData = {
                    em_id: window.currentEmId || (window.userInfo && window.userInfo.em_id),
                    rmtenant_id: rmtenantId
                };
                
                console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ì‚­ì œ ìš”ì²­:', requestData);
                
                // ì‚­ì œ ë²„íŠ¼ ë¹„í™œì„±í™”
                const deleteBtn = document.getElementById('tenant_modal_delete');
                const originalText = deleteBtn.textContent;
                deleteBtn.textContent = 'ì‚­ì œ ì¤‘...';
                deleteBtn.disabled = true;
                
                fetch('fm/rm_tenant/delete_tenant', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì…ì£¼ì‚¬ ì‚­ì œ ì‘ë‹µ:', data);
                    if (data && data.success) {
                        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        this.closeTenantModal();
                        // ì…ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        this.loadTenantList();
                    } else {
                        alert(`ì‚­ì œ ì‹¤íŒ¨: ${data ? data.message : 'Unknown error'}`);
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì…ì£¼ì‚¬ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                })
                .finally(() => {
                    // ì‚­ì œ ë²„íŠ¼ ë³µì›
                    deleteBtn.textContent = originalText;
                    deleteBtn.disabled = false;
                });
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ë‹«ê¸°
            closeTenantModal: function() {
                const modal = document.getElementById('tenant_modal_overlay');
                if (modal) {
                    modal.remove();
                }
                
                // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                if (this.tenantModalKeyHandler) {
                    document.removeEventListener('keydown', this.tenantModalKeyHandler);
                    this.tenantModalKeyHandler = null;
                }
                
                this.data.selectedTenantId = null;
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ìµœëŒ€í™”/ë³µì›
            toggleTenantModalMaximize: function() {
                const modal = document.getElementById('tenant_modal_content');
                const maximizeBtn = document.getElementById('tenant_modal_maximize');
                
                if (modal.classList.contains('maximized')) {
                    // ë³µì›
                    modal.classList.remove('maximized');
                    maximizeBtn.innerHTML = 'â¬œ';
                    maximizeBtn.title = 'ìµœëŒ€í™”';
                } else {
                    // ìµœëŒ€í™”
                    modal.classList.add('maximized');
                    maximizeBtn.innerHTML = 'ğŸ——';
                    maximizeBtn.title = 'ë³µì›';
                }
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ë“œë˜ê·¸ ì´ˆê¸°í™”
            initializeTenantModalDrag: function() {
                const header = document.querySelector('#tenant_modal_content .modal-header');
                const modal = document.getElementById('tenant_modal_content');
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                header.onmousedown = function(e) {
                    if (e.target.tagName === 'BUTTON') return;
                    
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    
                    const rect = modal.getBoundingClientRect();
                    startLeft = rect.left;
                    startTop = rect.top;
                    
                    document.onmousemove = function(e) {
                        if (!isDragging) return;
                        
                        const newLeft = startLeft + (e.clientX - startX);
                        const newTop = startTop + (e.clientY - startY);
                        
                        const maxLeft = window.innerWidth - modal.offsetWidth;
                        const maxTop = window.innerHeight - modal.offsetHeight;
                        
                        modal.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';
                        modal.style.top = Math.max(0, Math.min(newTop, maxTop)) + 'px';
                        modal.style.transform = 'none';
                    };
                    
                    document.onmouseup = function() {
                        isDragging = false;
                        document.onmousemove = null;
                        document.onmouseup = null;
                    };
                };
            },
            
            // ì…ì£¼ì‚¬ ëª¨ë‹¬ ë¦¬ì‚¬ì´ì¦ˆ ì´ˆê¸°í™”
            initializeTenantModalResize: function() {
                const modal = document.getElementById('tenant_modal_content');
                const handle = modal.querySelector('.modal-resize-handle');
                let isResizing = false;
                let startX, startY, startWidth, startHeight;
                
                handle.onmousedown = function(e) {
                    isResizing = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = modal.offsetWidth;
                    startHeight = modal.offsetHeight;
                    
                    document.onmousemove = function(e) {
                        if (!isResizing) return;
                        
                        const newWidth = startWidth + (e.clientX - startX);
                        const newHeight = startHeight + (e.clientY - startY);
                        
                        const minWidth = 600;
                        const minHeight = 400;
                        const maxWidth = window.innerWidth - 50;
                        const maxHeight = window.innerHeight - 50;
                        
                        modal.style.width = Math.max(minWidth, Math.min(newWidth, maxWidth)) + 'px';
                        modal.style.height = Math.max(minHeight, Math.min(newHeight, maxHeight)) + 'px';
                    };
                    
                    document.onmouseup = function() {
                        isResizing = false;
                        document.onmousemove = null;
                        document.onmouseup = null;
                    };
                };
            },
            
            // ì‹¤ì •ë³´ ì €ì¥
            saveRoom: function() {
                const rm_name = this.safeGetElement('rm_name');
                const rmNameValue = rm_name ? rm_name.value.trim() : '';
                
                if (!rmNameValue) {
                    alert('ì‹¤ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    if (rm_name) rm_name.focus();
                    return;
                }
                
                if (!confirm('ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
                
                const propIdOld = this.safeGetElement('prop_id_old');
                const blIdOld = this.safeGetElement('bl_id_old');
                const flIdOld = this.safeGetElement('fl_id_old');
                const rmIdOld = this.safeGetElement('rm_id_old');
                
                if (!propIdOld || !blIdOld || !flIdOld || !rmIdOld) {
                    alert('í•„ìˆ˜ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const requestData = {
                    em_id: window.currentEmId || (window.userInfo && window.userInfo.em_id),
                    prop_id_old: propIdOld.value,
                    bl_id_old: blIdOld.value,
                    fl_id_old: flIdOld.value,
                    rm_id_old: rmIdOld.value,
                    rm_name: rmNameValue
                };
                
                console.log('ğŸ  [RU] ì‹¤ì •ë³´ ì €ì¥ ìš”ì²­:', requestData);
                
                // í•„ìˆ˜ ë°ì´í„° ê²€ì¦
                if (!requestData.em_id) {
                    alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                fetch('fm/rm_update/save_room', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    console.log('ğŸ  [RU] Response status:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì‹¤ì •ë³´ ì €ì¥ ì‘ë‹µ:', data);
                    if (data && data.success) {
                        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert(`ì €ì¥ ì‹¤íŒ¨: ${data ? data.message : 'Unknown error'}`);
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì‹¤ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
                    alert(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                });
            },
            
            // ì‹¤ì •ë³´ ì‚­ì œ
            deleteRoom: function() {
                if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
                
                const requestData = {
                    em_id: window.currentEmId || (window.userInfo && window.userInfo.em_id),
                    prop_id: this.safeGetElement('prop_id_old').value,
                    bl_id: this.safeGetElement('bl_id_old').value,
                    fl_id: this.safeGetElement('fl_id_old').value,
                    rm_id: this.safeGetElement('rm_id_old').value
                };
                
                console.log('ğŸ  [RU] ì‹¤ì •ë³´ ì‚­ì œ ìš”ì²­:', requestData);
                
                fetch('fm/rm_update/delete_room', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('ğŸ  [RU] ì‹¤ì •ë³´ ì‚­ì œ ì‘ë‹µ:', data);
                    if (data && data.success) {
                        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        this.goToList();
                    } else {
                        alert(`ì‚­ì œ ì‹¤íŒ¨: ${data ? data.message : 'Unknown error'}`);
                    }
                })
                .catch(error => {
                    console.error('ğŸ  [RU] ì‹¤ì •ë³´ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                });
            },
            
            // ì…ì£¼ì‚¬ ê²€ìƒ‰
            searchTenant: function() {
                const searchInput = this.safeGetElement('tenant_search');
                this.data.tenantSearchKeyword = searchInput ? searchInput.value.trim() : '';
                this.loadTenantList();
            },
            
            // ëª©ë¡ìœ¼ë¡œ ì´ë™
            goToList: function() {
                try {
                    // tabManagerê°€ ìˆëŠ” ê²½ìš°
                    if (window.tabManager && window.tabManager.tabs) {
                        let rmListTabId = null;
                        
                        // tabsê°€ Map ê°ì²´ì¸ ê²½ìš°
                        if (window.tabManager.tabs instanceof Map) {
                            for (const [tabId, tab] of window.tabManager.tabs.entries()) {
                                if (tabId.includes('rm_list') || 
                                    (tab.url && tab.url.includes('rm_list.html')) ||
                                    (tab.title && tab.title === 'ì‹¤ì •ë³´')) {
                                    rmListTabId = tabId;
                                    console.log('ğŸŸ¢ [RU] ê¸°ì¡´ rm_list íƒ­ ë°œê²¬:', rmListTabId);
                                    break;
                                }
                            }
                        }
                        
                        // ê¸°ì¡´ íƒ­ì´ ìˆìœ¼ë©´ í™œì„±í™”
                        if (rmListTabId && typeof window.tabManager.switchToTab === 'function') {
                            window.tabManager.switchToTab(rmListTabId);
                            
                            // í˜„ì¬ rm_update íƒ­ ë‹«ê¸°
                            setTimeout(() => {
                                if (typeof window.tabManager.removeCurrentTab === 'function') {
                                    window.tabManager.removeCurrentTab();
                                }
                            }, 100);
                            
                            // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                            setTimeout(() => {
                                if (window.RmListModule && typeof window.RmListModule.refreshData === 'function') {
                                    window.RmListModule.refreshData();
                                } else if (window.RmListModule && typeof window.RmListModule.loadRoomData === 'function') {
                                    window.RmListModule.loadRoomData('read');
                                }
                            }, 300);
                            
                            console.log('ğŸŸ¢ [RU] ê¸°ì¡´ rm_list íƒ­ìœ¼ë¡œ ì´ë™ ì™„ë£Œ');
                            return;
                        }
                        
                        // ê¸°ì¡´ íƒ­ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                        if (typeof window.tabManager.addTab === 'function') {
                            window.tabManager.addTab('fm/rm_list.html', 'ì‹¤ì •ë³´');
                            
                            // í˜„ì¬ rm_update íƒ­ ë‹«ê¸°
                            setTimeout(() => {
                                if (typeof window.tabManager.removeCurrentTab === 'function') {
                                    window.tabManager.removeCurrentTab();
                                }
                            }, 200);
                            
                            return;
                        }
                    }
                    
                    // fallback
                    if (typeof window.loadContent === 'function') {
                        window.loadContent('fm/rm_list.html', 'ì‹¤ì •ë³´');
                    } else {
                        window.location.href = 'fm/rm_list.html';
                    }
                    
                } catch (error) {
                    console.error('ğŸ”´ [RU] ëª©ë¡ ì´ë™ ì¤‘ ì˜¤ë¥˜:', error);
                    
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê°•ì œë¡œ ìƒˆ íƒ­ ìƒì„±
                    if (window.tabManager && typeof window.tabManager.addTab === 'function') {
                        window.tabManager.addTab('fm/rm_list.html', 'ì‹¤ì •ë³´');
                    } else {
                        window.location.href = 'fm/rm_list.html';
                    }
                }
            },
            
            // ì…ì£¼ì‚¬ í…Œì´ë¸” ë¡œë”© í‘œì‹œ
            showTenantLoading: function() {
                const tableContent = this.safeGetElement('tenant_table_content');
                if (!tableContent) return;
                tableContent.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        ì…ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                `;
            },
            
            // ì˜¤ë¥˜ í‘œì‹œ
            showError: function(message) {
                console.error('ğŸ”´ [RU] ì‹¤ì •ë³´ ìˆ˜ì • ì˜¤ë¥˜:', message);
                alert(message);
            },
            
            // ì •ë¦¬ í•¨ìˆ˜
            cleanup: function() {
                console.log('ğŸ  [RU] RmUpdateModule ì •ë¦¬ ì¤‘...');
                this.data.isInitialized = false;
                
                // ëª¨ë‹¬ ë‹«ê¸°
                this.closeTenantModal();
            }
        };
        
        // ì „ì—­ ì´ˆê¸°í™” í•¨ìˆ˜ ë“±ë¡
        window.initializeRmUpdate = function() {
            window.RmUpdateModule.init();
        };
        
        // ì „ì—­ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ ë“±ë¡ (ì™¸ë¶€ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
        window.refreshRmUpdateData = function(prop_id, bl_id, fl_id, rm_id) {
            if (window.RmUpdateModule && typeof window.RmUpdateModule.refreshWithNewData === 'function') {
                window.RmUpdateModule.refreshWithNewData(prop_id, bl_id, fl_id, rm_id);
            }
        };
        
        // ìë™ ì´ˆê¸°í™” (ì¦‰ì‹œ ì‹¤í–‰)
        setTimeout(() => {
            console.log('ğŸ  [RU] RmUpdate ìë™ ì´ˆê¸°í™” ì‹œì‘');
            window.RmUpdateModule.init();
        }, 100);
        
        console.log('ğŸ  [RU] RmUpdateModule ë¡œë“œ ì™„ë£Œ');
        
    })(); // ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ ë
    </script>
</body>
</html>